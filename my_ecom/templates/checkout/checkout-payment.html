{% extends 'base/base-code.html' %}
{% load static %}
{% block title %}Checkout Payment{% endblock title %}
{% block main-content %}
	<!--start page wrapper -->
	<div class="page-wrapper">
		<div class="page-content">
			<!--start breadcrumb-->
			<section class="py-3 border-bottom border-top d-none d-md-flex bg-light">
				<div class="container">
					<div class="page-breadcrumb d-flex align-items-center">
						<h3 class="breadcrumb-title pe-3">Checkout</h3>
						<div class="ms-auto">
							<nav aria-label="breadcrumb">
								<ol class="breadcrumb mb-0 p-0">
									<li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i> Home</a>
									</li>
									<li class="breadcrumb-item"><a href="javascript:;">Shop</a>
									</li>
									<li class="breadcrumb-item active" aria-current="page">Checkout</li>
								</ol>
							</nav>
						</div>
					</div>
				</div>
			</section>
			<!--end breadcrumb-->
			<!--start shop cart-->
			<section class="py-4">
				<div class="container">
					<div class="shop-cart">
						<div class="row">
							<div class="col-12 col-xl-8">
								<div class="checkout-payment">
									<div class="card bg-transparent rounded-0 shadow-none">
										<div class="card-body">
											<div class="steps steps-light">
												<a class="step-item active" href="{% url 'shopping-cart' %}">
													<div class="step-progress"><span class="step-count">1</span>
													</div>
													<div class="step-label"><i class='bx bx-cart'></i>Cart</div>
												</a>
												<a class="step-item active" href="{% url 'checkout-details' %}">
													<div class="step-progress"><span class="step-count">2</span>
													</div>
													<div class="step-label"><i class='bx bx-user-circle'></i>Details</div>
												</a>
												<a class="step-item active" href="{% url 'checkout-shipping' %}">
													<div class="step-progress"><span class="step-count">3</span>
													</div>
													<div class="step-label"><i class='bx bx-cube'></i>Shipping</div>
												</a>
												<a class="step-item active current" href="{% url 'checkout-payment' %}">
													<div class="step-progress"><span class="step-count">4</span>
													</div>
													<div class="step-label"><i class='bx bx-credit-card'></i>Payment</div>
												</a>
												<a class="step-item" href="{% url 'checkout-review' %}">
													<div class="step-progress"><span class="step-count">5</span>
													</div>
													<div class="step-label"><i class='bx bx-check-circle'></i>Review</div>
												</a>
											</div>
										</div>
									</div>
									<div class="card rounded-0 shadow-none border">
										<div class="card-header border-bottom">
											<h2 class="h5 my-2">Choose Payment Method</h2>
										</div>
										<div class="card-body">
											<ul class="nav nav-pills mb-3 border p-3" role="tablist">
												<li class="nav-item" role="presentation">
													<a class="nav-link active rounded-0" data-bs-toggle="pill" href="#credit-card" role="tab" aria-selected="true">
														<div class="d-flex align-items-center">
															<div class="tab-icon"><i class='bx bx-credit-card font-18 me-1'></i>
															</div>
															<div class="tab-title">Credit Card</div>
														</div>
													</a>
												</li>
												<li class="nav-item" role="presentation">
													<a class="nav-link rounded-0" data-bs-toggle="pill" href="#paypal-payment" role="tab" aria-selected="false">
														<div class="d-flex align-items-center">
															<div class="tab-icon"><i class='bx bxl-paypal font-18 me-1'></i>
															</div>
															<div class="tab-title">Paypal</div>
														</div>
													</a>
												</li>
												<li class="nav-item" role="presentation">
													<a class="nav-link rounded-0" data-bs-toggle="pill" href="#net-banking" role="tab" aria-selected="false">
														<div class="d-flex align-items-center">
															<div class="tab-icon"><i class='bx bx-mobile font-18 me-1'></i>
															</div>
															<div class="tab-title">Net Banking</div>
														</div>
													</a>
												</li>
												<li class="nav-item" role="presentation">
													<a class="nav-link rounded-0" data-bs-toggle="pill" href="#cod" role="tab" aria-selected="false">
														<div class="d-flex align-items-center">
															<div class="tab-icon"><i class="fa-solid fa-wallet me-1"></i></div>
															<div class="tab-title">Cash on Delivery</div>
														</div>
													</a>
												</li>
											</ul>
											<form id="paymentForm" method="POST" action="{% url 'checkout-payment' %}">
												{% csrf_token %}
												<div class="form-check">
													<input class="form-check-input" type="checkbox" name="payment_method" value="COD" id="codCheckbox">
													<label class="form-check-label" for="codCheckbox">
														Cash on Delivery (Pay when you receive the order)
													</label>
												</div>
											</form>

											
											<div class="tab-content" id="pills-tabContent">
												<div class="tab-pane fade show active" id="credit-card" role="tabpanel">
													<div class="p-3 border">
														<form>
															<div class="mb-3">
																<label class="form-label">Card Owner</label>
																<input type="text" class="form-control rounded-0" placeholder="Card Owner name">
															</div>
															<div class="mb-3">
																<label class="form-label">Card number</label>
																<div class="input-group">
																	<input type="text" class="form-control rounded-0" placeholder="Valid Owner number">	<span class="input-group-text rounded-0"><img src="assets/images/icons/mastercard.png" width="35" alt=""></span>
																	<span class="input-group-text rounded-0"><img src="assets/images/icons/visa.png" width="35" alt=""></span>
																	<span class="input-group-text rounded-0"><img src="assets/images/icons/american-express.png" width="35" alt=""></span>
																</div>
															</div>
															<div class="row">
																<div class="col-12 col-lg-8">
																	<div class="mb-3">
																		<label class="form-label">Expiration Date</label>
																		<div class="input-group">
																			<input type="text" class="form-control rounded-0" placeholder="MM">
																			<input type="text" class="form-control rounded-0" placeholder="YY">
																		</div>
																	</div>
																</div>
																<div class="col-12 col-lg-4">
																	<div class="mb-3">
																		<label class="form-label">CVV</label>
																		<input type="text" class="form-control rounded-0" placeholder="Three digit CCV number">
																	</div>
																</div>
															</div>
															<div class="row">
																<div class="col-md-12">
																	<div class="d-grid">	<a href="javascript:;" class="btn btn-dark btn-ecomm rounded-0">Confirm Payment</a>
																	</div>
																</div>
															</div>
														</form>
													</div>
												</div>
												<div class="tab-pane fade" id="paypal-payment" role="tabpanel">
													<div class="p-3 border">
														<div class="mb-3">
															<p>Select your Paypal Account type</p>
															<div class="form-check form-check-inline">
																<input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1">
																<label class="form-check-label" for="inlineRadio1">Domestic</label>
															</div>
															<div class="form-check form-check-inline">
																<input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2">
																<label class="form-check-label" for="inlineRadio2">International</label>
															</div>
														</div>
														<div class="mb-3">
															<div class="d-block">	<a href="javscript:;" class="btn btn-light rounded-0"><i class='bx bxl-paypal'></i>Login to my Paypal</a>
															</div>
														</div>
														<div class="mb-3">
															<p class="mb-0">Note: After clicking on the button, you will be directed to a secure gateway for payment. After completing the payment process, you will be redirected back to the website to view details of your order.</p>
														</div>
													</div>
												</div>
												<div class="tab-pane fade" id="net-banking" role="tabpanel">
													<div class="p-3 border">
														<div class="mb-3">
															<p>Select your Bank</p>
															<select class="form-select rounded-0" aria-label="Default select example">
																<option selected>--Please Select Your Bank--</option>
																<option value="1">Bank Name 1</option>
																<option value="2">Bank Name 2</option>
																<option value="3">Bank Name 3</option>
															</select>
														</div>
														<div class="mb-3">
															<div class="d-block"> <a href="javscript:;" class="btn btn-light rounded-0"><i class='bx bxl-paypal'></i>Login to my Paypal</a>
															</div>
														</div>
														<div class="mb-3">
															<p class="mb-0">Note: After clicking on the button, you will be directed to a secure gateway for payment. After completing the payment process, you will be redirected back to the website to view details of your order.</p>
														</div>
													</div>
												</div>
											
											</div>
										</div>
									</div>
									<div class="card rounded-0 shadow-none border mt-3">
										<div class="card-body">
											<div class="row">
												<div class="col-md-6">
													<div class="d-grid">
														<a href="{% url 'checkout-shipping' %}" class="btn btn-light btn-ecomm">
															<i class="bx bx-chevron-left"></i> Back to Shipping
														</a>
													</div>
												</div>
												<div class="col-md-6">
													<div class="d-grid">
														<!-- This button will trigger form submission -->
														<button type="button" id="reviewBtn" class="btn btn-outline-dark btn-ecomm">
															Review Your Order <i class="bx bx-chevron-right"></i>
														</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-12 col-xl-4">
								<div class="order-summary">
									<div class="card rounded-0">
										<div class="card-body">
											<div class="card rounded-0 border bg-transparent shadow-none">
												<div class="card-body">
													<p class="fs-5 mb-3">Apply Discount Code</p>

													{% if request.session.coupon_code %}
														<div class="alert alert-success py-2 mb-2">
															<strong>Coupon Applied:</strong> {{ request.session.coupon_code }} <br>
															Discount: 
															${{ request.session.coupon_discount|default:order_data.discount|default:"0"|floatformat:2 }}
														</div>
														<form method="POST" action="{% url 'remove_coupon' %}">
															{% csrf_token %}
															<button class="btn btn-outline-danger btn-sm" type="submit">Remove Coupon</button>
														</form>
													{% else %}
														<form method="POST" action="{% url 'apply_coupon' %}">
															{% csrf_token %}
															<div class="input-group">
																<input type="text" name="coupon_code" class="form-control rounded-0" placeholder="Enter discount code" required>
																<button class="btn btn-dark btn-ecomm" type="submit">Apply</button>
															</div>
														</form>
													{% endif %}

												</div>

											</div>
											<div class="card rounded-0 border bg-transparent shadow-none">
												<div class="card-body" name="order_summary">
													<p class="fs-5">Order summary</p>
													<div class="my-3 border-top"></div>

													{% for cart_item in cart_items_base %}
													<div class="d-flex align-items-center mb-2">
														<a class="d-block flex-shrink-0" href="{% url 'product-detail' cart_item.item.product.slug %}">
															<img src="{{ cart_item.item.product.images.first.image.url }}" width="75" alt="{{ cart_item.item.product.title }}">
														</a>
														<div class="ps-2 flex-grow-1">
															<h6 class="mb-1">
																<a href="{% url 'product-detail' cart_item.item.product.slug %}" class="text-dark">
																	{{ cart_item.item.product.title }}
																</a>
															</h6>
															<div class="widget-product-meta">
																<span class="me-2">${{ cart_item.item.product.orginal_price|floatformat:2 }}</span>
																<span>x {{ cart_item.item.quantity }} = ${{ cart_item.item_total|floatformat:2 }}</span>
															</div>
														</div>
													</div>

													<div class="my-3 border-top"></div>
													{% endfor %}
												</div>

											</div>
											<div class="card rounded-0 border bg-transparent mb-0 shadow-none">
												<div class="card-body">
													<p class="mb-2">Subtotal: <span class="float-end">${{ order.subtotal }}</span></p>
													<p class="mb-2">Shipping: <span class="float-end">${{ order.shipping_charge }}</span></p>
													<p class="mb-2">
														Coupon Discount:
														<span class="float-end">
															-${{ request.session.coupon_discount|default:order.discount|floatformat:2 }}
														</span>
													</p>
													<div class="my-3 border-top"></div>
													<h5 class="mb-0">
														Order Total:
														<span class="float-end">
															${{ order.total_amount|floatformat:2 }}
														</span>
													</h5>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!--end row-->
					</div>
				</div>
			</section>
			<!--end shop cart-->
		</div>
	</div>
	<!--end page wrapper -->


<script>
document.getElementById('reviewBtn').addEventListener('click', function() {
    const codCheckbox = document.getElementById('codCheckbox');
    if (!codCheckbox.checked) {
        alert("Please select 'Cash on Delivery' before proceeding.");
    } else {
        document.getElementById('paymentForm').submit();
    }
});
</script>

{% endblock main-content %}